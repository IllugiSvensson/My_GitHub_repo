#include <MsgSender_lib.au3>

;–ü–†–û–í–ï–†–ö–ê –ó–ê–ü–£–°–ö–ê EXE –§–ê–ô–õ–ê
if $cmdLine[0] = 0 Then 	;–í—ã–∑—ã–≤–∞–µ—Ç—Å—è, –µ—Å–ª–∏ –Ω–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤

	$GUI = GUICreate("httpN –æ—Ç–ª–∞–¥–∫–∞", 256, 144, -1, -1, $WS_DLGFRAME)
	$Input = GUICtrlCreateInput("–í–≤–µ–¥–∏—Ç–µ –•–æ—Å—Ç–Ω–µ–π–º", 5, 15, 246, 40)
	GUICtrlSetFont($Input, 20)
	$BtnOk = GUICtrlCreateButton("–ü—É—Å–∫", 53, 60, 70, 50)
	GUICtrlSetFont($BtnOk, 16)
	$BtnNO = GUICtrlCreateButton("–í—ã—Ö–æ–¥", 133, 60, 70, 50)
	GUICtrlSetFont($BtnNO, 16)
	GUISetState()

	While True

		Switch GUIGetMsg()
			Case $BtnNO
				Exit

			Case $BtnOk
				Dim $cmdLine[2]
				$cmdLine[0] = "1"
				$cmdLine[1] = "httpn://KIT%20" & GUICtrlRead($Input)
				GUIDelete($GUI)
				ExitLoop

			EndSwitch

	WEnd

EndIf
;–ù–ê–°–¢–†–û–ô–ö–ê –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø –í –¢–†–ï–ï
Opt("TrayMenuMode", 1 + 2)	;–ù–µ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–∞–Ω–µ–ª–∏
TraySetState(2)				;–£–¥–∞–ª–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Ç—Ä–µ–µ
if FileExists("\\main\GetStand\App\httpN\system\temp\Sessions\UPDATE") = 1 Then ;–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

	MsgBox(48, "–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ", "–í–µ–¥—É—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã" & @CRLF & "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ –º–∏–Ω—É—Ç—É", 3)
	Exit

Endif



;–ü–†–û–í–ï–†–ö–ê MAC –ê–î–†–ï–°–ê –ò –ü–†–ê–í –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø –ü–û –°–ü–ò–°–ö–£ –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò
$ipAddr = ""
	For $i = 0 To (UBound($ip) - 1) Step +1

		$PID = Run(@ComSpec&' /c ipconfig | findstr ' & $ip[$i], '', @SW_HIDE, $STDOUT_CHILD) ;–ò—â–µ–º —Å–≤–æ–π ip –∞–¥—Ä–µ—Å
		$sStdOutRead = ""		;–í –∫–æ–Ω—Å–æ–ª–∏ –ø–æ–ª—É—á–∞–µ–º —Å—Ç—Ä–æ–∫—É —Å–æ —Å–≤–æ–∏–º –∞–¥—Ä–µ—Å–æ–º, –∑–∞–ø–∏—à–µ–º –µ—ë –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
			While 1				;–ö–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –Ω—É–∂–Ω–∞, —á—Ç–æ–±—ã –ø—Ä–æ—á–∏—Ç–∞—Ç—å –≤—ã–≤–æ–¥ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏(—Å—Ç—Ä–æ–∫—É —Å –Ω–∞–π–¥–µ–Ω–Ω—ã–º –∞–¥—Ä–µ—Å–æ–º)

				$sStdOutRead &= StdoutRead($PID) ;–ß–∏—Ç–∞–µ–º —Å—Ç—Ä–æ–∫—É –∏–∑ –∫–æ–Ω—Å–æ–ª–∏
				If @error Then ExitLoop

			WEnd
		if $sStdOutRead <> "" Then

			$ipAddr = StringRegExp($sStdOutRead, "((\d{1,3}\.){3}\d{1,3})", 3) ;–í—ã–¥–µ–ª—è–µ–º –Ω–∞—à –∞–¥—Ä–µ—Å –∏–∑ —Å—Ç—Ä–æ–∫–∏ –≤—ã–≤–æ–¥–∞
			ExitLoop

		EndIf

	Next
	if IsArray($ipAddr) <> 1 Then	;–ù–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–∏–ª—Å—è –º–∞–∫ –∞–¥—Ä–µ—Å

		BotMsg("üõë–û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏" & @CRLF & "‚ùåMAC-–∞–¥—Ä–µ—Å –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω" & @CRLF & " ‚è±" & _Now(), $sBotKey, $nChatId)
		Logger("MAC-–∞–¥—Ä–µ—Å –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–¥—Ä–µ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.", "", "", "", 2)
		MsgBox(16, "–û—à–∏–±–∫–∞", "MAC-–∞–¥—Ä–µ—Å –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω." & @CRLF & "–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –û—Ç–¥–µ–ª –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.", 3)
		Exit

	Endif
$MAC = GetMac($ipAddr[0])			;–ü–µ—Ä–µ–¥–∞–µ–º ip –∏ –ø–æ–ª—É—á–∞–µ–º MAC —Å–µ—Ç–µ–≤—É—à–∫–∏, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –Ω–∞–∑–Ω–∞—á–µ–Ω —ç—Ç–æ—Ç ip
$autorizedMac = FileReader("\\main\GetStand\App\httpN\system\MAC", $MAC) 	;–ò—â–µ–º MAC –≤ —Å–ø–∏—Å–∫–µ
;–ó–∞—Ö–≤–∞—Ç–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –≤ –≤–∏–¥–µ –∫–æ–¥–∞ —Å—Ç–æ–π–∫–∏-—Å—Ç–µ–Ω–¥–∞.
$hostName = StringRegExp(StringTrimLeft($cmdLine[1], 14), "\w+", 3) 	;–í—ã–±–∏—Ä–∞–µ–º –∏–º—è –∫–æ–º–ø—å—é—Ç–µ—Ä–∞
	if StringLeft($autorizedMac, 17) <> $MAC Then	;–ï—Å–ª–∏ MAC –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ —Å–ø–∏—Å–∫–µ, –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ–º —Ä–∞–±–æ—Ç—É

		BotMsg("üë§–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å" & @CRLF & "‚ö†Ô∏è–ü—ã—Ç–∞–ª—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Ö–æ—Å—Ç—É" & @CRLF & "üñ•Ô∏è" & $hostname[0] & " ‚è±" & _Now(), $sBotKey, $nChatId)
		Logger("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å(unknown)", $ipAddr[0] & "(" & $MAC & ")", "–ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –≤—Ö–æ–¥", $hostName[0], 1)
		MsgBox(16, "–û—à–∏–±–∫–∞", "–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–∞." & @CRLF & "–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –û—Ç–¥–µ–ª –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.", 3)
		Exit

	EndIf
;–ü—Ä–æ–≤–µ—Ä–∏–º –ø—Ä–∞–≤–∞ –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ. –ï—Å–ª–∏ –≤ —Å—Ç—Ä–æ–∫–µ –Ω–µ –Ω–∞–π–¥–µ–º –∏–º—è –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –∏–ª–∏ ADMIN, —Ç–æ –≤—ã–¥–∞–µ–º –æ—à–∏–±–∫—É.
	if (StringInStr($autorizedMac, $hostName[0]) = 0) And (StringInStr($autorizedMac, "ADMIN") = 0) Then

		MsgBox(48, "–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ", "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–∞–≤" & @CRLF & "–Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ " & $hostName[0], 3)
		Exit

	Endif



;–ü–û–õ–£–ß–ï–ù–ò–ï –ò–ù–§–û–†–ú–ê–¶–ò–ò –û –ö–û–ú–ü–¨–Æ–¢–ï–†–ï –°–¢–ï–ù–î–ê –ò–ó –ö–û–ú–ê–ù–î–ù–û–ô –°–¢–†–û–ö–ò –ó–ê–ü–£–°–ö–ê
ReDim $hostName[2]
$hostName[1] = FileReader("\\main\GetStand\App\httpN\system\HOSTS", $hostName[0])	;–ü–æ–ª—É—á–∏–º —Å—Ç—Ä–æ–∫—É —Å —Ö–æ—Å—Ç–æ–º –∏ –ø—Ä–æ—á–µ–π –∏–Ω—Ñ–æ–π, –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å
$hn = StringRegExp($hostName[1], "\w+", 3)		;–ü–æ–ª—É—á–∞–µ–º —Å—Ç—Ä–æ–∫—É —Å –∞–¥—Ä–µ—Å–æ–º –∏–ª–∏ 0
;–ò—â–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ö–æ—Å—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞ —Ö–æ—Å—Ç–æ–≤
	if ($hostName[1] = "0") Or (StringLen($hn[0]) <> StringLen($hostName[0])) Then	;–ï—Å–ª–∏ –∞–¥—Ä–µ—Å –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –∏–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω

		BotMsg("üõë–û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏" & @CRLF & "‚ùå–ê–¥—Ä–µ—Å —Ö–æ—Å—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω" & @CRLF & "üñ•Ô∏è" & $hostName[0] & " ‚è±" & _Now(), $sBotKey, $nChatId)
		Logger("–ê–¥—Ä–µ—Å –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ " & $hostName[0] & " –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ö–µ–º—É, —Å–ø–∏—Å–æ–∫ –∏ —Å—Ç—Ä–æ–∫—É –∑–∞–ø—É—Å–∫–∞.", "", "", "", 2)
		MsgBox(16, "–û—à–∏–±–∫–∞", "–ê–¥—Ä–µ—Å –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω." & @CRLF & "–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –û—Ç–¥–µ–ª –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.", 3)
		Exit

	EndIf
;–†–∞–∑–±–∏—Ä–∞–µ–º —Å—Ç—Ä–æ–∫—É –º–∞—Ä—à—Ä—É—Ç–∞, –µ—Å–ª–∏ —Ç–∞–∫–∞—è –∏–º–µ–µ—Ç—Å—è
$gwString = StringRegExp($hostname[1], "((\w+\.){3}\w+)", 2)	;–ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤ —Å—Ç—Ä–æ–∫–µ –º–∞—Ä—à—Ä—É—Ç
	if IsArray($gwString) = 1 Then

		$flag = 1		;–ï—Å–ª–∏ –º–∞—Ä—à—Ä—É—Ç –µ—Å—Ç—å, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å –º–∞—Ä—à—Ä—É—Ç–æ–º
		$gateWay = $gwString[0]			;–ü–æ–ª—É—á–∞–µ–º –∞–¥—Ä–µ—Å —à–ª—é–∑–∞
		;–£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã
		$hostName[1] = StringRegExpReplace($hostName[1], $hostname[0], "")
		$hostName[1] = StringRegExpReplace($hostName[1], $gwString[0], "")
		$hostName[1] = StringRegExpReplace($hostName[1], " ", "")
		;–ü—Ä–æ–≤–µ—Ä–∏–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å ip-–∞–¥—Ä–µ—Å—Å–æ–≤ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —á–∞—Å—Ç–Ω—ã–º —Å–µ—Ç—è–º ipv4
		if (Validator($gateWay, "^((10|192|127|169)\.){1}((25[0..5]|(2[0..4]\d|1{0,1}\d){0,1}\d)(\.?)){3}$") = 1) Or (Validator($hostName[1], "^((10|192|127|169)\.){1}((25[0..5]|(2[0..4]\d|1{0,1}\d){0,1}\d)(\.?)){3}$") = 1) Then

			BotMsg("üõë–û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏" & @CRLF & "‚ùå–û—à–∏–±–∫–∞ –≤ —Å–ø–∏—Å–∫–µ —Ö–æ—Å—Ç–æ–≤" & @CRLF & "üñ•Ô∏è" & $hostName[0] & " ‚è±" & _Now(), $sBotKey, $nChatId)
			Logger("–í –∑–∞–ø–∏—Å–∏ –∞–¥—Ä–µ—Å–∞ " & $hostName[0] & " –æ—à–∏–±–∫–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–ø–∏—Å—å –≤ —Å–ø–∏—Å–∫–µ —Ö–æ—Å—Ç–æ–≤.", "", "", "", 2)
			MsgBox(16, "–û—à–∏–±–∫–∞", "–û—à–∏–±–∫–∞ –≤ —Å–ø–∏—Å–∫–µ —Ö–æ—Å—Ç–æ–≤." & @CRLF & "–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –û—Ç–¥–µ–ª –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.", 3)
			Exit

		Endif
		$maskAddr = $hostName[1]		;–ü–æ–ª—É—á–∞–µ–º –∞–¥—Ä–µ—Å –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
		$MASK = AddrToMask($maskAddr)	;–ü–æ–ª—É—á–∞–µ–º –º–∞—Å–∫—É —Å–µ—Ç–∏

	else 					;–ï—Å–ª–∏ –º–∞—Ä—à—Ä—É—Ç–∞ –Ω–µ—Ç, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –∑–∞–ø—É—Å–∫–∞ –Ω–∞–ø—Ä—è–º—É—é

		$flag = 0			;–û–±–Ω—É–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, —á—Ç–æ–±—ã –ø—Ä–æ–≥—Ä–∞–º–º–∞ –Ω–µ –ø–∞–¥–∞–ª–∞
		$gateWay = 0
		$maskAddr = 0
		$MASK = 0

	EndIf



;–ó–ê–ü–£–°–ö –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø –ò –ù–ê–ë–õ–Æ–î–ï–ù–ò–ï –ó–ê –•–û–î–û–ú –†–ê–ë–û–¢–´
$exeFile = StringLeft($cmdLine[1], 11)	;–í—ã–±–∏—Ä–∞–µ–º –∏–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∑–∞–ø—É—Å–∫–∞
Switch $exeFile			;–ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –Ω—É–∂–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

	Case "httpn://VNC"
		$exeFile = "\\main\GetStand\App\vnc\VNC.exe"
		$Config = " -config \\main\GetStand\App\vnc\config\"
		TrackExeFile("VNC", $exeFile, $Config, ".vnc", $flag)

	Case "httpn://KIT"
		$exeFile = "\\main\GetStand\App\kitty\kitty.exe"
		$Config = " -load "
		TrackExeFile("Kitty", $exeFile, $Config, "", $flag)

	Case "httpn://SCP"
		$exeFile = "\\main\GetStand\App\winscp\WinSCP.exe"
		$Config = " "
		TrackExeFile("WinSCP", $exeFile, $Config, "", $flag)

	Case Else
		BotMsg("üõë–û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏" & @CRLF & "‚ùå–û—à–∏–±–∫–∞ –≤ —Å—Å—ã–ª–∫–µ –Ω–∞ —Å—Ö–µ–º–µ" & @CRLF & "üñ•Ô∏è" & $hostName[0] & " ‚è±" & _Now(), $sBotKey, $nChatId)
		Logger("–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ " & $exeFile & " –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ö–µ–º—É, –∑–∞–ø–∏—Å–∏ –∏ –¥–∏—Å–∫ GetStand.", "", "", "", 2)
		MsgBox(16, "–û—à–∏–±–∫–∞", "–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è." & @CRLF & "–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –û—Ç–¥–µ–ª –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.", 3)
		Exit

EndSwitch





;–ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨–°–ö–ò–ï –§–£–ù–ö–¶–ò–ò
Func ConsolePing($ADD)							;–§—É–Ω–∫—Ü–∏—è –ø–∏–Ω–≥–∞

	Sleep(1000)		;–ë–µ–∑ –ø–∞—É–∑—ã –ø–æ—á–µ–º—É —Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –Ω–µ –ø–∏–Ω–≥—É–µ—Ç—Å—è
;–í–û–ó–ú–û–ñ–ù–û –ü–†–ò–î–ï–¢–°–Ø –ú–ï–ù–Ø–¢–¨ –í–û–ó–í–†–ê–©–ê–ï–ú–û–ï –ó–ù–ê–ß–ï–ù–ò–ï, –ï–°–õ–ò –ù–ï –ë–£–î–ï–¢ –î–ù–°
	return Ping($ADD & ".ot.net")

EndFunc

Func AddrToMask($MSKADDR)						;–§—É–Ω–∫—Ü–∏—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∞–¥—Ä–µ—Å–∞ –≤ –º–∞—Å–∫—É

	Switch "1"	;REGEX –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ –ª–∏–±–æ –¥–≤–æ–∏—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ. –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å –µ–¥–∏–Ω–∏—Ü–µ–π –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞

		Case StringRegExp($MSKADDR, "((\d{1,3}\.){1}0.0.0)", 0) ;–ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∞–∫—Ç–µ—Ç—ã –Ω–∞ 0
			return "255.0.0.0"							 	 	;–í–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∞—Å–∫—É

		Case StringRegExp($MSKADDR, "((\d{1,3}\.){2}0.0)", 0)
			return "255.255.0.0"

		Case StringRegExp($MSKADDR, "((\d{1,3}\.){3}0)", 0)
			return "255.255.255.0"

		Case Else
			return "255.255.255.255"

	EndSwitch

EndFunc

Func Logger($USER, $ADDRES, $ACT, $HOST, $TYPE)	;–§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

	If $TYPE = 1 Then			;–ó–∞–ø–∏—Å—å –ª–æ–≥–∞ –∑–∞–ø—É—Å–∫–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

		$tmpPath = "\\main\GetStand\App\httpN\system\log\log.txt"	;–ü—É—Ç—å –¥–æ –ª–æ–≥–∞
		$TIME = StringFormat("%-19s", _Now())						;–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤—ã–≤–æ–¥ –ø–æ–¥ —Å—Ç–∞–Ω–¥–∞—Ä—Ç
		$USER = StringFormat("%-33s", $USER)
		$ADDRES = StringFormat("%-34s", $ADDRES)
		$ACT = StringFormat("%-21s", $ACT)
		FileWriteLine($tmpPath, $TIME & " | " & $USER & " | " & $ADDRES & " | " & $ACT & " | " & $HOST )

	ElseIf $TYPE = 2 Then		;–ó–∞–ø–∏—Å—å —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ª–æ–≥–∞

		FileWriteLine("\\main\GetStand\App\httpN\system\log\system.txt", StringFormat("%-19s", _Now()) & " | " & $USER)

	EndIf

EndFunc

Func RouteAddDel($ROUTE, $fl)					;–§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞

	if $fl = 1 Then

		$hFile = FileOpen("\\main\GetStand\App\httpN\system\temp\system.bat", 2)	;–û—Ç–∫—Ä—ã–≤–∞–µ—Ç –±–∞—Ç–Ω–∏–∫ –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏
		FileWrite($hFile, $ROUTE) 													;–í–ø–∏—Å—ã–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
		ShellExecute("\\main\GetStand\App\httpN\system\temp\httpN.lnk")				;–ó–∞–ø—É—Å–∫–∞–µ–º –±–∞—Ç–Ω–∏–∫ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–π–∫–∏/—É–¥–∞–ª–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞
		FileClose($hFile)															;–ó–∞–∫—Ä—ã–≤–∞–µ–º —Ñ–∞–π–ª

	EndIf

EndFunc

Func TrackExeFile($EXE, $exeFile, $CONFIG, $RES, $flg)	;–§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –∏ —Å–ª–µ–∂–µ–Ω–∏—è –∑–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º

	;–í—ã–¥–µ–ª—è–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Å—Ç—Ä–æ–∫–∏, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–æ–≤
	$name = StringRegExp($autorizedMac, "[–∞-—è–ê-–Ø]{1,}\s{1,}[–∞-—è–ê-–Ø]{1,}\(\w+\)", 3)
	RouteAddDel("route add " & $maskAddr & " mask " & $MASK & " " & $gateWay, $flg)		;–°—Ç—Ä–æ–∏–º –º–∞—Ä—à—Ä—É—Ç –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
	if (ConsolePing($hostName[0])) = 0 Then		;–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ—Ç—å. –ï—Å–ª–∏ –Ω–µ –ø–∏–Ω–≥—É–µ—Ç—Å—è

		BotMsg("üë§" & $name[0] & @CRLF & "‚ö†Ô∏è–ù–µ—É–¥–∞—á–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ" & @CRLF & "üñ•Ô∏è" & $hostName[0] & " üïπ" & $EXE & " ‚è±" & _Now(), $sBotKey, $nChatId)
		Logger($name[0], $ipAddr[0] & "(" & $MAC & ")", "–•–æ—Å—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç", $hostName[0] & ":" & $EXE, 1)
		MsgBox(16, "–û—à–∏–±–∫–∞", "–ù–µ—É–¥–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Ö–æ—Å—Ç—É." & @CRLF & "–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –û—Ç–¥–µ–ª –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.", 3)

	else		;–ï—Å–ª–∏ –ø–∏–Ω–≥—É–µ—Ç—Å—è, –∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

		$PID = Run($exeFile & $CONFIG & $hostName[0] & $RES)							;–ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ —Ñ–∏–∫—Å–∏—Ä—É–µ–º –µ–≥–æ PID
		BotMsg("üë§" & $name[0] & @CRLF & "‚úÖ–ü–æ–¥–∫–ª—é—á–∏–ª—Å—è –∫ —Ö–æ—Å—Ç—É" & @CRLF & "üñ•Ô∏è" & $hostName[0] & " üïπ" & $EXE & " ‚è±" & _Now(), $sBotKey, $nChatId)
		Logger($name[0], $ipAddr[0] & "(" & $MAC & ")", "–£—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ", $hostName[0] & ":" & $EXE, 1)
		;–ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Å—Å–∏—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
		$t = 0
		While True

			Sleep(1000)		;–û—Ç—Å—á–∏—Ç—ã–≤–∞–µ–º —É—Å–ª–æ–≤–Ω—É—é —Å–µ–∫—É–Ω–¥—É
			$t += 1
			;–£—Å–ª–æ–≤–∏—è –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å–µ—Å—Å–∏–∏
			If ProcessExists($PID) = 0	Then	;–ï—Å–ª–∏ –∑–∞–≤–µ—Ä—à–∏–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –≤—Ä—É—á–Ω—É—é

				BotMsg("üë§" & $name[0] & @CRLF & "‚¨ÖÔ∏è–û—Ç–∫–ª—é—á–∏–ª—Å—è –æ—Ç —Ö–æ—Å—Ç–∞" & @CRLF & "üñ•Ô∏è" & $hostName[0] & " üïπ" & $EXE & " ‚è±" & _Now(), $sBotKey, $nChatId)
				Logger($name[0], $ipAddr[0] & "(" & $MAC & ")", "–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã", $hostName[0] & ":" & $EXE, 1)
				ExitLoop

			ElseIf FileExists("\\main\GetStand\App\httpN\system\temp\Sessions\UPDATE") = 1 Then ;–ï—Å–ª–∏ –Ω–∞—á–∞–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

				MsgBox(48, "–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ", "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ä–∞–±–æ—Ç—É." & @CRLF & "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–∫—Ä–æ–µ—Ç—Å—è —á–µ—Ä–µ–∑ –º–∏–Ω—É—Ç—É.", 5)
				$j = 0
				While $j <> 55

					sleep(1000)
					$j += 1
					if ProcessExists($PID) = 0 Then ExitLoop
					if FileExists("\\main\GetStand\App\httpN\system\temp\Sessions\KILL") = 1 Then ExitLoop

				WEnd
				ProcessClose($PID)
				ExitLoop

			ElseIf $t = 30000 Then				;–ï—Å–ª–∏ –¥–æ–∂–¥–∞–ª–∏—Å—å —Ç–∞–π–º–∞—É—Ç–∞

				ProcessClose($PID)
				BotMsg("üë§" & $name[0] & @CRLF & "‚¨ÖÔ∏è–°–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞" & @CRLF & "üñ•Ô∏è" & $hostName[0] & " üïπ" & $EXE & " ‚è±" & _Now(), $sBotKey, $nChatId)
				Logger($name[0], $ipAddr[0] & "(" & $MAC & ")", "–°–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞", $hostName[0] & ":" & $EXE, 1)
				MsgBox(48, "–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ", "–°–µ—Å—Å–∏—è " & $hostName[0] & ": " & $EXE & @CRLF & "–∑–∞–≤–µ—Ä—à–µ–Ω–∞ –ø–æ —Ç–∞–π–º–∞—É—Ç—É", 3)
				ExitLoop

			Endif

			;–§—É–Ω–∫—Ü–∏–∏, –¥–µ–π—Å—Ç–≤—É—é—â–∏–µ –≤–æ –≤—Ä–µ–º—è —Å–µ—Å—Å–∏–∏
			if FileExists("\\main\GetStand\App\httpN\system\temp\Sessions\ONLINE") = 1 Then		;–ì–æ–≤–æ—Ä–∏–º —á—Ç–æ –æ–Ω–ª–∞–π–Ω

				;–°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª–∏–∫-–º–µ—Ç–∫—É, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –µ–≥–æ –¥—Ä—É–≥–æ–π –ø—Ä–æ–≥–æ–π, –∫–æ—Ç–æ—Ä–∞—è –µ–≥–æ —É–¥–∞–ª–∏—Ç
				FileWrite("\\main\GetStand\App\httpN\system\temp\PIDS\" & $name[0] & "." & $hostName[0] & "." & Round($t/60), "")

			Endif

		WEnd

	Endif

	;–ö–æ–≥–¥–∞ –∑–∞–∫–æ–Ω—á–∏–ª–∏ —Ä–∞–±–æ—Ç—É –∏–ª–∏ –Ω–µ —Å–º–æ–≥–ª–∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è, –Ω—É–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç –∑–∞ —Å–æ–±–æ–π
	if UBound(ProcessList("httpN.exe")) = 2 Then			;–ï—Å–ª–∏ —Ñ–∞–π–ª –æ–¥–∏–Ω (–Ω–∞—à —Ñ–∞–π–ª)

		RouteAddDel("route delete " & $maskAddr, $flg)	;–£–¥–∞–ª—è–µ–º –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã

	EndIf

EndFunc