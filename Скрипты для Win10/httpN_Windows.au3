#include <httpN_Windows_lib.au3>



;–ü–†–û–í–ï–†–ö–ê –ò –ó–ê–ü–£–°–ö –ï–•–ï –§–ê–ô–õ–ê
TraySetState(2)				;–£–¥–∞–ª–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Ç—Ä–µ–µ
If FileExists(@ScriptDir & "\system\temp\Sessions\UPDATE") = 1 Then 		;–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

	MsgBox(48, "–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ", "–í–µ–¥—É—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã" & @CRLF & "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ", 3)
	Exit

EndIf
If $cmdLine[0] = 0 Then 	;–í—ã–∑—ã–≤–∞–µ—Ç—Å—è, –µ—Å–ª–∏ –Ω–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤

	Local $inputText = EntryWindow(1)										;–°—Ç—Ä–æ–∏–º –æ–∫–Ω–æ –¥–ª—è –≤–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö
	Dim $cmdLine[2]
	$cmdLine[0] = "1"		;–†–∞–∑–±–∏—Ä–∞–µ–º –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
	$cmdLine[1] = "httpn://" & StringLeft($InputText, 3) & "%20" & StringTrimLeft($InputText, 4)

EndIf



;–ü–†–û–í–ï–†–ö–ê –ò–ú–ï–ù–ò –ò –ü–†–ê–í –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø –ü–û –°–ü–ò–°–ö–£ –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò
Global $username = @ComputerName
	If StringLen($username) = 0 Then		;–ù–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–∏–ª–æ—Å—å –∏–º—è

		BotMsg("üõë<b>–û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</b>" & @CRLF & "‚ùå–ò–º—è –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ" & @CRLF & "‚è±" & _Now(), 0)
		Logger("–ò–º—è –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–º–ø—å—é—Ç–µ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.", "", "", "", 2)
		MsgBox(16, "–û—à–∏–±–∫–∞", "–ò–º—è –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ" & @CRLF & "–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –û—Ç–¥–µ–ª –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è", 3)
		Exit

	EndIf
Global $autorizedUser = FileReader(@ScriptDir & "\system\USERS", $username) ;–ò—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–ø–∏—Å–∫–µ
;–ó–∞—Ö–≤–∞—Ç–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –≤ –≤–∏–¥–µ –∫–æ–¥–∞ —Å—Ç–æ–π–∫–∏-—Å—Ç–µ–Ω–¥–∞.
Global $hostName = StringRegExp(StringTrimLeft($cmdLine[1], 14), "\w+", 3) 	;–í—ã–±–∏—Ä–∞–µ–º –∏–º—è –∫–æ–º–ø—å—é—Ç–µ—Ä–∞
	If StringLen($autorizedUser) = 1 Then	;–ï—Å–ª–∏ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ —Å–ø–∏—Å–∫–µ, –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ–º —Ä–∞–±–æ—Ç—É

		Local $eks = StringTrimRight(StringTrimLeft($cmdLine[1], 8), StringLen($hostName[0]) + 4)
		BotMsg("üë§<b>–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</b>" & @CRLF & "‚ö†Ô∏è–ü—ã—Ç–∞–ª—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Ö–æ—Å—Ç—É" & @CRLF & "üñ•Ô∏è" & $hostname[0] & " üïπ" & $eks & " ‚è±" & _Now(), 0)
		Logger("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å(unknown)", $username, "–ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –≤—Ö–æ–¥", $hostName[0] & ":" & $eks, 1)
		MsgBox(16, "–û—à–∏–±–∫–∞", "–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–∞" & @CRLF & "–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –û—Ç–¥–µ–ª –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è", 3)
		Exit

	EndIf
;–í—ã–¥–µ–ª—è–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Å—Ç—Ä–æ–∫–∏, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–æ–≤
Global $name = StringRegExp($autorizedUser, "[–∞-—è–ê-–Ø]{1,}\s{1,}[–∞-—è–ê-–Ø]{1,}\(\w+\)", 3)
	If StringLeft($cmdLine[1], 11) == "httpn://FBC" Then					;–û–∫–æ—à–∫–æ –¥–ª—è —Ñ–∏–¥–±–µ–∫–∞

		Local $stend = StringTrimRight(StringTrimLeft($cmdLine[1], 14), 1)
		Local $feedback = EntryWindow(2)
		BotMsg("@IllugiSven" & @CRLF & "üë§" & $name[0] & @CRLF & "‚ö†Ô∏è–ù–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ" & @CRLF & "üñ•Ô∏è–°—Ç–µ–Ω–¥: " & $stend & " ‚è±" & _Now(), 0)
		Logger($name[0] & ". –°—Ç–µ–Ω–¥: " & $stend & ". " & $feedback, "", "", "", 2)
		MsgBox(64, "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è", "–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞–Ω–æ" & @CRLF & "—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É", 3)
		Exit

	EndIf
;–ü—Ä–æ–≤–µ—Ä–∏–º –ø—Ä–∞–≤–∞ –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ. –ï—Å–ª–∏ –≤ —Å—Ç—Ä–æ–∫–µ –Ω–µ –Ω–∞–π–¥–µ–º –∏–º—è –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –∏–ª–∏ ADMIN, —Ç–æ –≤—ã–¥–∞–µ–º –æ—à–∏–±–∫—É.
	If (StringInStr($autorizedUser, $hostName[0]) = 0) And (StringInStr($autorizedUser, "ADMIN") = 0) Then

		MsgBox(48, "–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ", "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–∞–≤" & @CRLF & "–Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ " & $hostName[0], 4)
		Exit

	EndIf



;–ü–û–õ–£–ß–ï–ù–ò–ï –ò–ù–§–û–†–ú–ê–¶–ò–ò –û –ö–û–ú–ü–¨–Æ–¢–ï–†–ï –°–¢–ï–ù–î–ê –ò–ó –ö–û–ú–ê–ù–î–ù–û–ô –°–¢–†–û–ö–ò –ó–ê–ü–£–°–ö–ê
ReDim $hostName[2]
$hostName[1] = FileReader(@ScriptDir & "\system\HOSTS", $hostName[0])		;–ü–æ–ª—É—á–∏–º —Å—Ç—Ä–æ–∫—É —Å —Ö–æ—Å—Ç–æ–º –∏ –ø—Ä–æ—á–µ–π –∏–Ω—Ñ–æ–π, –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å
Local $hn = StringRegExp($hostName[1], "\w+", 3)
	If ($hostName[1] = "0") Or (StringLen($hn[0]) <> StringLen($hostName[0])) Then	;–ï—Å–ª–∏ –∏–º—è –Ω–µ –Ω–∞–π–¥–µ–Ω–æ

		BotMsg("üõë<b>–û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</b>" & @CRLF & "‚ùå–ò–º—è —Ö–æ—Å—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ" & @CRLF & "üñ•Ô∏è" & $hostName[0] & " ‚è±" & _Now(), 0)
		Logger("–ò–º—è –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ " & $hostName[0] & " –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ö–µ–º—É, —Å–ø–∏—Å–æ–∫ –∏ —Å—Ç—Ä–æ–∫—É –∑–∞–ø—É—Å–∫–∞.", "", "", "", 2)
		MsgBox(16, "–û—à–∏–±–∫–∞", "–ò–º—è –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ" & @CRLF & "–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –û—Ç–¥–µ–ª –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è", 3)
		Exit

	EndIf
;–†–∞–∑–±–∏—Ä–∞–µ–º —Å—Ç—Ä–æ–∫—É –∞–¥—Ä–µ—Å–∞ –∏ –º–∞—Ä—à—Ä—É—Ç–∞, –µ—Å–ª–∏ —Ç–∞–∫–æ–π –µ—Å—Ç—å
Local $addcheck = StringRegExp($hostName[1], "[A]((\w+\.){3}\w+)", 2)		;–ü–æ–ª—É—á–∞–µ–º —à–∞–±–ª–æ–Ω –¥–Ω—Å –∞–¥—Ä–µ—Å–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞
;–ü—Ä–æ–≤–µ—Ä–∏–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å ip-–∞–¥—Ä–µ—Å—Å–æ–≤ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —á–∞—Å—Ç–Ω—ã–º —Å–µ—Ç—è–º ipv4
;–í–æ–æ–±—â–µ –±–ª–æ–∫ —Å –∞–¥—Ä–µ—Å–æ–º –∏ –∞–¥—Ä–µ—Å–∞–º–∏ —à–ª—é–∑–∞ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–¥ –ø—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–æ–≤
;"^((10|192|127|169)\.){1}((25[0..5]|(2[0..4]\d|1{0,1}\d){0,1}\d)(\.?)){3}$" –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –∑–Ω–∞—á–∞—â–∏–µ –Ω—É–ª–∏
	If IsArray($addcheck) = 0 Then

		BotMsg("üõë<b>–û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</b>" & @CRLF & "‚ùå–û—à–∏–±–∫–∞ –≤ —Å–ø–∏—Å–∫–µ —Ö–æ—Å—Ç–æ–≤" & @CRLF & "üñ•Ô∏è" & $hostName[0] & " ‚è±" & _Now(), 0)
		Logger("–í –∑–∞–ø–∏—Å–∏ –∞–¥—Ä–µ—Å–∞ " & $hostName[0] & " –æ—à–∏–±–∫–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–ø–∏—Å—å –≤ —Å–ø–∏—Å–∫–µ —Ö–æ—Å—Ç–æ–≤.", "", "", "", 2)
		MsgBox(16, "–û—à–∏–±–∫–∞", "–û—à–∏–±–∫–∞ –≤ —Å–ø–∏—Å–∫–µ —Ö–æ—Å—Ç–æ–≤" & @CRLF & "–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –û—Ç–¥–µ–ª –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è", 3)
		Exit

	EndIf
Global $address = StringTrimLeft($addcheck[0], 1)							;–ü–æ–ª—É—á–∞–µ–º –¥–Ω—Å –∞–¥—Ä–µ—Å –∫–æ–º–ø—å—é—Ç–µ—Ä–∞
Local $gwcheck = StringRegExp($hostName[1], "[G]((\w+\.){3}\w+)", 2)		;–ü–æ–ª—É—á–∞–µ–º —à–∞–±–ª–æ–Ω –∞–¥—Ä–µ—Å–∞ —à–ª—é–∑–∞
Local $mskcheck = StringRegExp($hostName[1], "[M]((\w+\.){3}\w+)", 2)		;–ü–æ–ª—É—á–∞–µ–º —à–∞–±–ª–æ–Ω –º–∞—Å–∫–∏ —à–ª—é–∑–∞
	If IsArray($gwcheck) = 1 Then

		Global $flag = 1		;–ï—Å–ª–∏ –º–∞—Ä—à—Ä—É—Ç –µ—Å—Ç—å, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å –º–∞—Ä—à—Ä—É—Ç–æ–º
		Global $gateway = StringTrimLeft($gwcheck[0], 1)
		Global $maskAddr = StringTrimLeft($mskcheck[0], 1)
		Global $gatemask = AddrToMask($maskAddr)		;–ü–æ–ª—É—á–∞–µ–º –º–∞—Å–∫—É —Å–µ—Ç–∏
		If (Validator($gateway, "((\w+\.){3}\w+)") = 1) Or (Validator($maskAddr, "((\w+\.){3}\w+)") = 1) Then

			BotMsg("üõë<b>–û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</b>" & @CRLF & "‚ùå–û—à–∏–±–∫–∞ –≤ —Å–ø–∏—Å–∫–µ —Ö–æ—Å—Ç–æ–≤" & @CRLF & "üñ•Ô∏è" & $hostName[0] & " ‚è±" & _Now(), 0)
			Logger("–í –∑–∞–ø–∏—Å–∏ –∞–¥—Ä–µ—Å–∞ " & $hostName[0] & " –æ—à–∏–±–∫–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–ø–∏—Å—å –≤ —Å–ø–∏—Å–∫–µ —Ö–æ—Å—Ç–æ–≤.", "", "", "", 2)
			MsgBox(16, "–û—à–∏–±–∫–∞", "–û—à–∏–±–∫–∞ –≤ —Å–ø–∏—Å–∫–µ —Ö–æ—Å—Ç–æ–≤" & @CRLF & "–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –û—Ç–¥–µ–ª –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è", 3)
			Exit

		EndIf

	Else 						;–ï—Å–ª–∏ –º–∞—Ä—à—Ä—É—Ç–∞ –Ω–µ—Ç, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ –∑–∞–ø—É—Å–∫–∞ –Ω–∞–ø—Ä—è–º—É—é

		Global $flag = 0		;–û–±–Ω—É–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, —á—Ç–æ–±—ã –ø—Ä–æ–≥—Ä–∞–º–º–∞ –Ω–µ –ø–∞–¥–∞–ª–∞
		Global $gateway = 0
		Global $maskAddr = 0
		Global $gatemask = 0

	EndIf



;–ó–ê–ü–£–°–ö –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø –ò –ù–ê–ë–õ–Æ–î–ï–ù–ò–ï –ó–ê –•–û–î–û–ú –†–ê–ë–û–¢–´
Global $Config, $exeFile = StringLeft($cmdLine[1], 11)	;–í—ã–±–∏—Ä–∞–µ–º –∏–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∑–∞–ø—É—Å–∫–∞
Global $appfolder = StringTrimRight(@ScriptDir, 6)
Switch $exeFile					;–ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –Ω—É–∂–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

	Case "httpn://VNC"
		$exeFile = $appfolder & "\vnc\VNC.exe"
		$Config = " -config " & $appfolder & "\vnc\config\"
		TrackExeFile("VNC", $exeFile, $Config, ".vnc", $flag)

	Case "httpn://KIT"
		$exeFile = $appfolder & "\kitty\kitty.exe"
		$Config = " -load "
		TrackExeFile("Kitty", $exeFile, $Config, "", $flag)

	Case "httpn://SCP"
		$exeFile = $appfolder & "\winscp\WinSCP.exe"
		$Config = " "
		TrackExeFile("WinSCP", $exeFile, $Config, "", $flag)

	Case Else
		BotMsg("üõë<b>–û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</b>" & @CRLF & "‚ùå–û—à–∏–±–∫–∞ –≤ —Å—Å—ã–ª–∫–µ –Ω–∞ —Å—Ö–µ–º–µ" & @CRLF & "üñ•Ô∏è" & $hostName[0] & " ‚è±" & _Now(), 0)
		Logger("–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ " & $exeFile & " " & $hostName[0] & " –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ö–µ–º—É, –∑–∞–ø–∏—Å–∏ –∏ –¥–∏—Å–∫ GetStand.", "", "", "", 2)
		MsgBox(16, "–û—à–∏–±–∫–∞", "–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è" & @CRLF & "–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –û—Ç–¥–µ–ª –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è", 3)
		Exit

EndSwitch